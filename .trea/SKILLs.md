\# ğŸ›  SKILLS.md: rs-vision-hub-go å¼€å‘è§„æ ¼è¯´æ˜ä¹¦

\#\# 1\. é¡¹ç›®æ¦‚è§ˆ (Project Overview)

**\*\*rs-vision-hub-go\*\*** æ˜¯ä¸€ä¸ªåŸºäº NVIDIA Jetson å¹³å°çš„å®æ—¶è§†è§‰ç›‘æ§åº”ç”¨ã€‚

æœ¬é¡¹ç›®ä½œä¸º \`jetson-rs-middleware\` çš„å®˜æ–¹æµ‹è¯•å®ç°ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯æ¼”ç¤ºå¦‚ä½•é€šè¿‡çº¯ Go è¯­è¨€è·å– RealSense ç›¸æœºçš„å¯¹é½æµï¼Œå¹¶åœ¨æœ¬åœ°å åŠ å®æ—¶ HUDï¼ˆå¹³è§†æ˜¾ç¤ºå™¨ï¼‰ä¿¡æ¯è¿›è¡ŒåŒè·¯æ¸²æŸ“ã€‚

\---

\#\# 2\. æ ¸å¿ƒä¾èµ–ä¸å­˜æ”¾è·¯å¾„ (Core Dependencies)

\#\#\# 2.1 çº¿ä¸Šä¸­é—´ä»¶ (Middleware)

æœ¬é¡¹ç›®æ·±åº¦ä¾èµ–ä»¥ä¸‹çº¿ä¸Šä»“åº“ï¼Œæ— éœ€æœ¬åœ°æ‰‹åŠ¨ä¸‹è½½æºç ï¼Œç”± Go Modules è‡ªåŠ¨ç®¡ç†ã€‚

\* **\*\*ä»“åº“åœ°å€\*\***: \`github.com/tianfei212/jetson-rs-middleware\`

\* **\*\*èŒè´£\*\***: å°è£… CGO é€»è¾‘ï¼Œæä¾› \`rs2.Pipeline\` ç­‰æ ¸å¿ƒ Go æ¥å£ã€‚

\#\#\# 2.2 è§†è§‰åº“ (Visual Library)

\* **\*\*GoCV\*\***: \`gocv.io/x/gocv\` (ç”¨äºçª—å£ç®¡ç†ã€é¢œè‰²æ˜ å°„åŠå›¾åƒå åŠ )ã€‚

\---

\#\# 3\. é¡¹ç›®ç›®å½•ç»“æ„ (Project Structure)

\`\`\`text

rs-vision-hub-go/

â”œâ”€â”€ cmd/

â”‚   â””â”€â”€ hub/

â”‚       â””â”€â”€ main.go          \# åº”ç”¨å…¥å£ï¼šæ§åˆ¶ Pipeline ç”Ÿå‘½å‘¨æœŸä¸æ¸²æŸ“ä¸»å¾ªç¯

â”œâ”€â”€ pkg/

â”‚   â”œâ”€â”€ bridge/

â”‚   â”‚   â””â”€â”€ middleware.go    \# é€‚é…å™¨ï¼šå°è£…å¯¹çº¿ä¸Šä¸­é—´ä»¶çš„è°ƒç”¨é€»è¾‘

â”‚   â”œâ”€â”€ processor/

â”‚   â”‚   â”œâ”€â”€ converter.go     \# è½¬æ¢å™¨ï¼šByte Slice è½¬ GoCV Mat (é›¶æ‹·è´)

â”‚   â”‚   â””â”€â”€ colorizer.go     \# ä¸Šè‰²å™¨ï¼šå°† 16bit æ·±åº¦å›¾æ˜ å°„ä¸º 8bit ä¼ªå½©è‰²å›¾

â”‚   â”œâ”€â”€ hud/

â”‚   â”‚   â””â”€â”€ painter.go       \# è§†è§‰å±‚ï¼šåœ¨å›¾åƒä¸Šå®æ—¶ç»˜åˆ¶æ—¶é—´æˆ³ã€FPS ä¸å…ƒæ•°æ®

â”‚   â””â”€â”€ display/

â”‚       â””â”€â”€ screen.go        \# æ¸²æŸ“å±‚ï¼šç®¡ç†åŒçª—å£åŒæ­¥æ˜¾ç¤ºé€»è¾‘

â”œâ”€â”€ go.mod                   \# ä¾èµ–é…ç½®ï¼šå£°æ˜å¼•ç”¨ tianfei212/jetson-rs-middleware

â””â”€â”€ Makefile                 \# è‡ªåŠ¨åŒ–è„šæœ¬ï¼šå¤„ç†æ„å»ºä¸ CGO é“¾æ¥å‚æ•°

---

## **4\. æ ¸å¿ƒæ•°æ®æ¨¡å‹ (Data Entities)**

### **4.1 UnifiedFrame**

æ‰€æœ‰æ¨¡å—é—´ä¼ é€’çš„æ ¸å¿ƒå¯¹è±¡ï¼Œç¡®ä¿ RGB ä¸ Depth æ•°æ®çš„åŸå­æ€§åŒæ­¥ã€‚

Go

type UnifiedFrame struct {

    RawColor   \[\]byte            // æ¥è‡ªä¸­é—´ä»¶çš„åŸå§‹ RGB å­—èŠ‚æµ

    RawDepth   \[\]byte            // æ¥è‡ªä¸­é—´ä»¶çš„åŸå§‹ 16bit æ·±åº¦å­—èŠ‚æµ

    Width      int               // å›¾åƒå®½åº¦

    Height     int               // å›¾åƒé«˜åº¦

    Timestamp  time.Time         // ç³»ç»Ÿæ•è·æ—¶åˆ»

    FrameIndex uint64            // ç¡¬ä»¶å¸§åºåˆ—å· (Frame Number)

}

---

## **5\. å‡½æ•°å®šä¹‰ä¸èŒè´£ (Function Definitions)**

### **ğŸ“‚ pkg/bridge/middleware.go**

* **func NewMiddlewareClient(w, h, fps int) (\*RS2Client, error)**  
  * **å¼€å‘æŒ‡å¯¼**: å¿…é¡»åœ¨æ­¤å¤„æ˜¾å¼å¼€å¯ä¸­é—´ä»¶çš„ Align åŠŸèƒ½ï¼Œç¡®ä¿æ·±åº¦ç‚¹äº‘ä¸å½©è‰²åƒç´ åœ¨ç©ºé—´ä¸Šå®Œå…¨é‡åˆã€‚  
* **func (c \*RS2Client) Fetch() (\*UnifiedFrame, error)**  
  * **å¼€å‘æŒ‡å¯¼**: å†…éƒ¨è°ƒç”¨çº¿ä¸Šåº“çš„ WaitForFrames()ï¼Œå¹¶åˆ©ç”¨ time.Now() è®°å½•ç³»ç»Ÿåˆ°è¾¾æ—¶é—´ã€‚

### **ğŸ“‚ pkg/processor/converter.go & colorizer.go**

* **func ToMat(data \[\]byte, w, h int, t gocv.MatType) gocv.Mat**  
  * **å¼€å‘æŒ‡å¯¼**: å¿…é¡»ä½¿ç”¨ gocv.NewMatFromBytes ä»¥å®ç°é›¶æ‹·è´ï¼Œä¸¥ç¦åœ¨å¤„ç†å¾ªç¯ä¸­äº§ç”Ÿä¸å¿…è¦çš„å†…å­˜å¤åˆ¶ã€‚  
* **func ColorizeDepth(rawDepth gocv.Mat) gocv.Mat**  
  * **èŒè´£**: å°†åŸå§‹æ·±åº¦å€¼è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¹¶åº”ç”¨ gocv.ColorMapJet è½¬æ¢ä¸ºæ˜“äºè§‚å¯Ÿçš„å½©è™¹å›¾ã€‚

### **ğŸ“‚ pkg/hud/painter.go**

* **func OverlayHUD(img \*gocv.Mat, batch \*UnifiedFrame)**  
  * **èŒè´£**: åœ¨å›¾åƒå³ä¸Šè§’ç»˜åˆ¶ 2006-01-02 15:04:05.000 æ—¶é—´æˆ³ï¼›å·¦ä¸‹è§’æ˜¾ç¤º FPSã€åˆ†è¾¨ç‡å’Œå¸§åºå·ã€‚  
  * **äº¤äº’è¦æ±‚**: HUD æ–‡å­—éœ€å¸¦æœ‰åŠé€æ˜é»‘è‰²èƒŒæ™¯é®ç½©ï¼Œç¡®ä¿åœ¨å¼ºå…‰ç¯å¢ƒä¸‹æ¸…æ™°å¯è§ã€‚

### **ğŸ“‚ pkg/display/screen.go**

* **func (s \*Screen) Render(color, depth gocv.Mat)**  
  * **èŒè´£**: åœ¨ RGB Stream å’Œ Depth Stream ä¸¤ä¸ªç‹¬ç«‹çª—å£åŒæ­¥åˆ·æ–°å›¾åƒã€‚

---

## **6\. äº¤äº’é€»è¾‘ä¸çº¦æŸ (Interaction Requirements)**

### **ğŸ”„ å¼€å‘æ ¸å¿ƒæµç¨‹**

1. **Init**: main.go è°ƒç”¨ bridge.NewMiddlewareClient å»ºç«‹è¿æ¥ã€‚  
2. **Pull**: è¿›å…¥ä¸»å¾ªç¯ï¼ŒåŒæ­¥è°ƒç”¨ Fetch()ã€‚  
3. **Process**:  
   * å°†å­—èŠ‚æµè½¬æ¢ä¸º colorMat å’Œ depthMatã€‚  
   * å¯¹ colorMat æ‰§è¡Œ hud.OverlayHUDã€‚  
   * å¯¹ depthMat æ‰§è¡Œ processor.ColorizeDepthã€‚  
4. **Display**: è°ƒç”¨ screen.Render å±•ç¤ºç»“æœã€‚  
5. **Clean**: **å¿…é¡»**æ˜¾å¼è°ƒç”¨ mat.Close() é‡Šæ”¾ GoCV å†…å­˜ã€‚

### **âš ï¸ åµŒå¥—å¼€å‘å‡†åˆ™ (Strict Rules)**

1. **ä¸­é—´ä»¶å¼•ç”¨**: ä¸¥ç¦åœ¨åº”ç”¨å±‚ä¿®æ”¹ä¸­é—´ä»¶è¿”å›çš„ \[\]byte å†…å®¹ã€‚  
2. **æ¸²æŸ“é™åˆ¶**: å— OpenCV/X11 é™åˆ¶ï¼Œæ‰€æœ‰çš„çª—å£åˆ›å»ºä¸ IMShow å¿…é¡»åœ¨**ä¸»çº¿ç¨‹ (Main Goroutine)** ä¸­æ‰§è¡Œã€‚  
3. **èµ„æºå›æ”¶**: é‰´äº Jetson èµ„æºæœ‰é™ï¼Œå•æ¬¡å¾ªç¯è€—æ—¶åº”æ§åˆ¶åœ¨ **16ms (60fps)** æˆ– **33ms (30fps)** ä»¥å†…ã€‚  
4. **ç¡¬ä»¶å®¹é”™**: è‹¥ä¸­é—´ä»¶è¿”å›è®¾å¤‡ä¸¢å¤±é”™è¯¯ï¼Œç¨‹åºåº”æ‰§è¡Œ pipeline.Stop() å¹¶è¿›å…¥é‡è¿æœºåˆ¶ã€‚

---

## **7\. æ„å»ºä¸è¿è¡Œ (Build & Run)**

Bash

\# 1\. ä¸‹è½½çº¿ä¸Šä¾èµ–

go mod download \[github.com/tianfei212/jetson-rs-middleware\](https://github.com/tianfei212/jetson-rs-middleware)

\# 2\. ç¼–è¯‘

go build \-o rs-vision-hub ./cmd/hub/main.go

\# 3\. è¿è¡Œ

./rs-vision-hub

\---

\*\*JOJO\*\*ï¼Œè¿™ä»½æ–‡æ¡£å·²ç»å‡†å¤‡å¥½äº†ã€‚

\*\*ä½ æƒ³è®©æˆ‘ä¸‹ä¸€æ­¥åšä»€ä¹ˆï¼Ÿ\*\*

\* \*\*A\*\*: ç¼–å†™ \`go.mod\` æ–‡ä»¶ï¼ˆåŒ…å«å¯¹ä½  GitHub ä»“åº“çš„æ­£ç¡®å¼•ç”¨ï¼‰ã€‚

\* \*\*B\*\*: ç¼–å†™ \`cmd/hub/main.go\` çš„æ ¸å¿ƒä»£ç æ¡†æ¶ï¼Œç›´æ¥å±•ç¤ºå¦‚ä½•è·‘é€šè¿™ä¸ªæµç¨‹ã€‚

\* \*\*C\*\*: ç¼–å†™ \`Makefile\`ï¼ŒæŠŠ CGO çš„é“¾æ¥è·¯å¾„ä¸€æ¬¡æ€§é…å¥½ã€‚

